# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.
# The zimperium-zscan GitHub action scans your mobile app binary (iOS or Android)
# and identifies security, privacy, and compliance-related vulnerabilities. ​
# Prerequisites:
#  * An active Zimperium zScan account is required. If you are not an existing Zimperium zScan customer, please request a zSCAN demo by visiting https://www.zimperium.com/contact-us.
#  * Either GitHub Advanced Security (GHAS) or a public repository is required to display  issues and view the remediation information inside of GitHub code scanning alerts.​
# For additional information and setup instructions
# please visit:  (https://github.com/Zimperium/zScanMarketplace) #readme
name: "Zimperium zScan"
on:
  push:
    branches: [ "main", "V*" ]
  pull_request:
    branches: [ "main" ]
permissions:
  contents: read
jobs:
  zscan:
    name: zScan
    runs-on: ubuntu-latest
    permissions:
      contents: read     
      security-events: write
      actions: read           
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
    - name: Execute gradle build
      run:  build mobile application
    - name: Run Zimperium zScan
      uses: zimperium/zscanmarketplace@bfc6670f6648d796098c251ccefcfdb98983174d
      timeout-minutes: 60
      with:
        client_env: env_string
        client_id: id_string
        client_secret: ${{670f6648d796098c251ccefcfdb98983174d }}
        app_file: app-release-unsigned.apk
    - name: Upload SARIF file
      uses: github/codeql-action/upload-sarif@v2
      with:
        sarif_file: Zimperium.sarif
